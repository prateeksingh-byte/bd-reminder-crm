<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kepler Follow-Up CRM</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--blue:#2563eb;--bg:#f9fafb;--card:#ffffff;--muted:#6b7280}
*{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
body{margin:0;background:var(--bg);color:#111827}
.header{background:linear-gradient(90deg,var(--blue),#1e40af);color:#fff;padding:18px 24px;display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px}
.logo{font-weight:800;font-size:20px;letter-spacing:1px}
.tag{opacity:.9;font-size:13px}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
.grid{display:grid;grid-template-columns:360px 1fr;gap:20px}
.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,.06)}
.title{font-weight:700;margin:0 0 8px}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input,select{width:100%;padding:10px;border:1px solid #e6e6e6;border-radius:8px;font-size:14px}
button.btn{background:var(--blue);color:#fff;padding:10px 12px;border-radius:8px;border:0;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.table-controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.search{flex:1}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #f1f1f1}
th{font-weight:600;color:var(--muted);font-size:13px}
tr.overdue{background:#fff1f1}
tr.today{background:#fff9e6}
tr.done{color:#6b7280;text-decoration:line-through;background:#f3f4f6}
.muted{color:var(--muted);font-size:13px}
.right{display:flex;gap:8px;align-items:center}
.tiny{padding:6px 8px;font-size:13px;border-radius:8px}
.export{background:#16a34a}
.hint{font-size:12px;color:var(--muted);margin-top:8px}
@media(max-width:900px){.grid{grid-template-columns:1fr}.header{padding:12px}.container{padding:0 10px}}
</style>
</head>
<body>
<div class="header">
  <div class="brand">
    <div class="logo">KEPLER</div>
    <div class="tag">Managed Workspaces | Client Follow-ups | Growth Tracking</div>
  </div>
  <div class="right"><div class="muted" id="welcome">Welcome</div></div>
</div>

<div class="container">
  <div class="grid">
    <div class="card">
      <h3 class="title">Add / Quick Reminder</h3>
      <div class="muted">Enter your name once (saved to this browser).</div>
      <label>Your name</label>
      <input type="text" id="userName" placeholder="Enter your name (e.g. Prateek)" />
      <label>Client name</label>
      <input type="text" id="inputName" placeholder="Client name" />
      <label>Company</label>
      <input type="text" id="inputCompany" placeholder="Company" />
      <label>Next action</label>
      <input type="text" id="inputAction" placeholder="Call / Email / Meeting" />
      <label>Date & time</label>
      <input type="datetime-local" id="inputDatetime" />
      <div style="height:12px"></div>
      <button class="btn" id="addBtn">Add Reminder</button>
      <button class="tiny" id="enableAlerts">Enable Notifications & Sound</button>
      <div class="hint">Allow notifications to get reminder popups with sound.</div>
    </div>

    <div>
      <div class="card" style="margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div>
            <h3 class="title">Reminders</h3>
            <div class="muted">Live synced with Google Sheet</div>
          </div>
          <div class="table-controls">
            <input class="search" type="text" id="filter" placeholder="Search..." />
            <button class="tiny" id="refresh">Refresh</button>
            <button class="tiny export" id="exportBtn">Export CSV</button>
          </div>
        </div>
        <div style="overflow:auto;max-height:420px">
          <table id="remTable">
            <thead><tr><th>Name</th><th>Company</th><th>Action</th><th>Date</th><th>Time</th><th>Status</th><th>Last Updated By</th><th></th></tr></thead>
            <tbody id="remBody"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h3 class="title">History</h3>
        <div id="historyList" style="max-height:220px;overflow:auto"></div>
      </div>
    </div>
  </div>
</div>

<audio id="notifySound"><source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg"></audio>

<script>
const API_URL = https://script.google.com/macros/s/AKfycbxeTW8ci9jH_gLvJxD2IOHnKZF6xuyz2jAqqL5epBe0BarUw1udDjNGP24J4_GepyhGlA/exec;
let reminders = [];
const userNameEl=document.getElementById("userName"),welcomeEl=document.getElementById("welcome"),
inputName=document.getElementById("inputName"),inputCompany=document.getElementById("inputCompany"),
inputAction=document.getElementById("inputAction"),inputDatetime=document.getElementById("inputDatetime"),
remBody=document.getElementById("remBody"),historyList=document.getElementById("historyList"),
notifySound=document.getElementById("notifySound");

init();
async function init(){
  const stored=localStorage.getItem("bd_user");
  if(stored){userNameEl.value=stored;welcomeEl.textContent="Welcome, "+stored+" ðŸ‘‹";}
  loadFromSheet();
  document.getElementById("addBtn").onclick=addReminder;
  document.getElementById("enableAlerts").onclick=requestNotif;
  document.getElementById("refresh").onclick=loadFromSheet;
  document.getElementById("exportBtn").onclick=exportCSV;
}
async function loadFromSheet(){
  try{
    const res=await fetch(API_URL);
    const data=await res.json();
    reminders=[];
    for(let i=1;i<data.length;i++){
      const r=data[i];
      reminders.push({name:r[0],company:r[1],action:r[2],date:r[3],time:r[4],status:r[5],last:r[6]});
    }
    render();
  }catch(e){alert("Failed to load data");}
}
function render(){
  remBody.innerHTML="";
  reminders.forEach((r,i)=>{
    const row=document.createElement("tr");
    const dt=new Date(r.date+"T"+(r.time||"00:00"));
    const now=new Date();
    if(r.status==="Done")row.classList.add("done");
    else if(dt<now)row.classList.add("overdue");
    else if(dt.toDateString()===now.toDateString())row.classList.add("today");
    row.innerHTML=`<td>${r.name}</td><td>${r.company}</td><td>${r.action}</td>
    <td>${r.date}</td><td>${r.time}</td><td>${r.status||"Pending"}</td>
    <td>${r.last}</td><td>${r.status!=="Done"?`<button class='tiny' onclick='markDone(${i})'>Done</button>`:""}</td>`;
    remBody.appendChild(row);
  });
}
async function addReminder(){
  const user=userNameEl.value.trim();if(!user){alert("Enter your name");return;}
  localStorage.setItem("bd_user",user);welcomeEl.textContent="Welcome, "+user+" ðŸ‘‹";
  const n=inputName.value.trim(),c=inputCompany.value.trim(),a=inputAction.value.trim(),dt=inputDatetime.value;
  if(!n||!a||!dt)return alert("Please fill all required fields");
  const [d,t]=dt.split("T");
  const payload={name:n,company:c,action:a,date:d,time:t,status:"Pending",history:JSON.stringify({lastUpdatedBy:user,note:'Created'})};
  await fetch(API_URL,{method:"POST",body:JSON.stringify(payload)});
  loadFromSheet();
  inputName.value=inputCompany.value=inputAction.value=inputDatetime.value="";
}
async function markDone(i){
  const r=reminders[i];const user=userNameEl.value.trim()||"System";
  const payload={name:r.name,company:r.company,action:r.action,date:r.date,time:r.time,status:"Done",history:JSON.stringify({lastUpdatedBy:user,note:'Completed'})};
  await fetch(API_URL,{method:"POST",body:JSON.stringify(payload)});loadFromSheet();
}
function requestNotif(){
  Notification.requestPermission().then(p=>{if(p==="granted"){notifySound.play();alert("Notifications enabled");}});
}
function exportCSV(){
  let csv="Name,Company,Action,Date,Time,Status,LastUpdatedBy\\n";
  reminders.forEach(r=>{csv+=`${r.name},${r.company},${r.action},${r.date},${r.time},${r.status},${r.last}\\n`;});
  const blob=new Blob([csv],{type:"text/csv"});const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);link.download="reminders.csv";link.click();
}
</script>
</body>
</html>

